"use strict";(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[221],{24221:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var n=function(){var t=this,e=t._self._c;return e("page-view",[e("a-row",[e("a-col",{attrs:{span:24}},[e("a-card",{attrs:{bodyStyle:{padding:"16px"},bordered:!1}},[e("a-card",{staticClass:"environment-info",attrs:{bodyStyle:{padding:"16px"},bordered:!1}},[e("template",{slot:"title"},[t._v(" 环境信息 "),e("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:t.handleCopyEnvironments}},[e("a-icon",{attrs:{type:"copy"}})],1)],1),e("a-popover",{attrs:{slot:"extra",title:t.isLatest?"当前为最新版本":"有新版本",placement:"left"},slot:"extra"},[e("template",{slot:"content"},[e("p",[t._v(t._s(t.versionMessage))]),e("a-button",{attrs:{type:"dashed"},on:{click:t.handleShowVersionContent}},[t._v("查看详情")])],1),e("a-button",{attrs:{icon:t.isLatest?"check-circle":"exclamation-circle",loading:t.checking,shape:"circle",type:"dashed"}})],2),e("ul",{staticClass:"p-0 m-0 list-none"},[e("li",[t._v("版本："+t._s(t.environments.version))]),e("li",[t._v("数据库："+t._s(t.environments.database))]),e("li",[t._v("运行模式："+t._s(t.environments.mode))]),e("li",[t._v("启用主题："+t._s(t.activatedTheme.name))]),e("li",[t._v("启动时间："+t._s(t._f("moment")(t.environments.startTime)))]),e("li",[t._v("* 注意：当前版本为 Halo-Plus，由 Halo 1.6.1 继续开发而来，非 Halo 官方版本。")])]),e("a",{staticClass:"mr-3",attrs:{href:"https://blog.nineya.com",target:"_blank"}},[t._v("个人博客 "),e("a-icon",{attrs:{type:"link"}})],1),e("a",{staticClass:"mr-3",attrs:{href:"https://github.com/nineya",target:"_blank"}},[t._v("开源作者 "),e("a-icon",{attrs:{type:"link"}})],1),e("a",{staticClass:"mr-3",attrs:{href:"https://docs.halo-plus.nineya.com",target:"_blank"}},[t._v("Halo-Plus文档 "),e("a-icon",{attrs:{type:"link"}})],1),e("a",{staticClass:"mr-3",attrs:{href:"https://halo.run",target:"_blank"}},[t._v("Halo官网 "),e("a-icon",{attrs:{type:"link"}})],1),e("a",{staticClass:"mr-3",attrs:{href:"https://bbs.halo.run",target:"_blank"}},[t._v("Halo社区 "),e("a-icon",{attrs:{type:"link"}})],1)],2),e("a-card",{attrs:{bodyStyle:{padding:"16px"},bordered:!1,loading:t.contributorsLoading,title:"开发者"}},t._l(t.contributors,(function(a,n){return e("a",{key:n,attrs:{href:a.html_url,target:"_blank"}},[e("a-tooltip",{attrs:{title:a.login,placement:"top"}},[e("a-avatar",{style:{marginRight:"10px",marginBottom:"10px"},attrs:{alt:a.login,src:t._f("webpAvatarConvert")(a.avatar_url),size:"large"}})],1)],1)})),0)],1)],1),e("a-col",{attrs:{span:24}})],1),e("a-modal",{attrs:{title:t.versionContentModalTitle,visible:t.versionContentVisible,width:620,"ok-text":"查看更多"},on:{cancel:function(e){t.versionContentVisible=!1},ok:t.handleOpenVersionUrl}},[e("div",{domProps:{innerHTML:t._s(t.versionContent)}})])],1)},s=[],r=a(73541),i=a(9669),o=a.n(i),l=a(87441),c=a(72286);const h=o().create({baseURL:"https://api.github.com",timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/vnd.github.v3+json"},withCredentials:!1});var p={components:{PageView:c.B4},data(){return{environments:{},contributors:[{login:"",id:0,node_id:"",avatar_url:"",gravatar_id:"",url:"",html_url:"",followers_url:"",following_url:"",gists_url:"",starred_url:"",subscriptions_url:"",organizations_url:"",repos_url:"",events_url:"",received_events_url:"",type:"",site_admin:!1,contributions:0}],contributorsLoading:!0,checking:!1,isLatest:!1,latestData:{},versionContentVisible:!1,activatedTheme:{}}},computed:{versionMessage(){return`当前版本：${this.environments.version}，${this.isLatest?"已经是最新版本。":`新版本：${this.latestData.name}，你可以点击下方按钮查看详情。`}`},versionContent(){return this.latestData&&this.latestData.body?l.TU.parse(this.latestData.body):"暂无内容"},versionContentModalTitle(){return`${this.latestData.name} 更新内容`}},created(){this.getEnvironments(),this.handleGetActivatedTheme(),this.fetchContributors()},methods:{async getEnvironments(){const{data:t}=await r.Z.getEnvironment();this.environments=t,this.checkServerUpdate()},async handleGetActivatedTheme(){const{data:t}=await r.Z.theme.getActivatedTheme();this.activatedTheme=t},handleCopyEnvironments(){const t=`版本：${this.environments.version}\n数据库：${this.environments.database}\n运行模式：${this.environments.mode}\n启用主题：${this.activatedTheme.name}\nUser Agent：${navigator.userAgent}`;this.$copyText(t).then((t=>{this.$log.debug("copy",t),this.$message.success("复制成功！")})).catch((t=>{this.$log.debug("copy.err",t),this.$message.error("复制失败！")}))},fetchContributors(){const t=this;t.contributorsLoading=!0,new Promise(((e,a)=>{h.get("/repos/nineya/halo-plus/contributors?per_page=50").then((n=>{h.get("/repos/halo-dev/halo/contributors?per_page=50").then((a=>{t.contributors=[...n.data,...a.data],e()})).catch((function(t){a(t)}))})).catch((function(t){a(t)}))})).catch((function(e){t.$log.error("Fetch contributors error",e)})).finally((()=>{t.contributorsLoading=!1}))},checkServerUpdate(){const t=this.$createElement,e=this;e.checking=!0,h.get("/repos/nineya/halo-plus/releases/latest").then((a=>{const n=a.data;if(e.latestData=n,n.draft||n.prerelease)return;const s=e.calculateIntValue(e.environments.version),r=e.calculateIntValue(n.name);if(s>=r)return void(e.isLatest=!0);const i="新版本提醒",o="检测到 Halo-Plus 新版本："+n.name+"，点击下方按钮查看最新版本。";e.$notification.open({message:i,description:o,icon:t("a-icon",{attrs:{type:"smile"},style:"color: #108ee9"}),btn:t=>t("a-button",{props:{type:"primary",size:"small"},on:{click:()=>this.handleShowVersionContent()}},"去看看")})})).catch((function(t){this.$log.error("Check update fail",t)})).finally((()=>{this.checking=!1}))},handleShowVersionContent(){this.versionContentVisible=!0},handleOpenVersionUrl(){window.open(this.latestData.html_url,"_blank")},calculateIntValue(t){t=t.replace(/v/g,"");const e=t.split(".");if(null==e||3!==e.length)return-1;const a=parseInt(e[0]),n=parseInt(e[1]),s=parseInt(e[2]);return isNaN(a)||isNaN(n)||isNaN(s)?-1:1e6*a+1e3*n+s}},filters:{webpAvatarConvert(t){return t.replace("avatars.githubusercontent.com","avatars-githubusercontent.webp.se")}}},u=p,d=a(1001),v=(0,d.Z)(u,n,s,!1,null,null,null),m=v.exports}}]);