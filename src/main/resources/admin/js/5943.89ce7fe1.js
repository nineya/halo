"use strict";(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[5943],{45943:function(e,t,s){s.r(t),s.d(t,{diagram:function(){return Q}});var o=s(41504),i=s(45625),n=s(88828),a=s(85322),r=s(87936);s(27484),s(17967),s(27856),s(41644),s(39354);const d="rect",c="rectWithTitle",l="start",p="end",b="divider",g="roundedWithTitle",h="note",u="noteGroup",y="statediagram",f="state",$=`${y}-${f}`,w="transition",m="note",x="note-edge",T=`${w} ${x}`,k=`${y}-${m}`,S="cluster",D=`${y}-${S}`,A="cluster-alt",v=`${y}-${A}`,B="parent",C="note",E="state",R="----",V=`${R}${C}`,N=`${R}${B}`,L="fill:none",M="fill: #333",z="c",I="text",P="normal";let W={},Y=0;const _=function(e){const t=Object.keys(e);for(const s of t)e[s]},j=function(e,t){return t.db.extract(t.db.getRootDocV2()),t.db.getClasses()};function G(e){return void 0===e||null===e?"":e.classes?e.classes.join(" "):""}function O(e="",t=0,s="",o=R){const i=null!==s&&s.length>0?`${o}${s}`:"";return`${E}-${e}${i}-${t}`}const q=(e,t,s,i,n,r)=>{const y=s.id,f=G(i[y]);if("root"!==y){let t=d;!0===s.start&&(t=l),!1===s.start&&(t=p),s.type!==o.D&&(t=s.type),W[y]||(W[y]={id:y,shape:t,description:a.e.sanitizeText(y,(0,a.c)()),classes:`${f} ${$}`});const i=W[y];s.description&&(Array.isArray(i.description)?(i.shape=c,i.description.push(s.description)):i.description.length>0?(i.shape=c,i.description===y?i.description=[s.description]:i.description=[i.description,s.description]):(i.shape=d,i.description=s.description),i.description=a.e.sanitizeTextOrArray(i.description,(0,a.c)())),1===i.description.length&&i.shape===c&&(i.shape=d),!i.type&&s.doc&&(a.l.info("Setting cluster for ",y,H(s)),i.type="group",i.dir=H(s),i.shape=s.type===o.a?b:g,i.classes=i.classes+" "+D+" "+(r?v:""));const n={labelStyle:"",shape:i.shape,labelText:i.description,classes:i.classes,style:"",id:y,dir:i.dir,domId:O(y,Y),type:i.type,padding:15,centerLabel:!0};if(s.note){const t={labelStyle:"",shape:h,labelText:s.note.text,classes:k,style:"",id:y+V+"-"+Y,domId:O(y,Y,C),type:i.type,padding:15},o={labelStyle:"",shape:u,labelText:s.note.text,classes:i.classes,style:"",id:y+N,domId:O(y,Y,B),type:"group",padding:0};Y++;const a=y+N;e.setNode(a,o),e.setNode(t.id,t),e.setNode(y,n),e.setParent(y,a),e.setParent(t.id,a);let r=y,d=t.id;"left of"===s.note.position&&(r=t.id,d=y),e.setEdge(r,d,{arrowhead:"none",arrowType:"",style:L,labelStyle:"",classes:T,arrowheadStyle:M,labelpos:z,labelType:I,thickness:P})}else e.setNode(y,n)}t&&"root"!==t.id&&(a.l.trace("Setting node ",y," to be child of its parent ",t.id),e.setParent(y,t.id)),s.doc&&(a.l.trace("Adding nodes children "),F(e,s,s.doc,i,n,!r))},F=(e,t,s,i,n,r)=>{a.l.trace("items",s),s.forEach((s=>{switch(s.stmt){case o.b:q(e,t,s,i,n,r);break;case o.D:q(e,t,s,i,n,r);break;case o.S:{q(e,t,s.state1,i,n,r),q(e,t,s.state2,i,n,r);const o={id:"edge"+Y,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:L,labelStyle:"",label:a.e.sanitizeText(s.description,(0,a.c)()),arrowheadStyle:M,labelpos:z,labelType:I,thickness:P,classes:w};e.setEdge(s.state1.id,s.state2.id,o,Y),Y++}break}}))},H=(e,t=o.c)=>{let s=t;if(e.doc)for(let o=0;o<e.doc.length;o++){const t=e.doc[o];"dir"===t.stmt&&(s=t.value)}return s},J=async function(e,t,s,o){a.l.info("Drawing state diagram (v2)",t),W={},o.db.getDirection();const{securityLevel:c,state:l}=(0,a.c)(),p=l.nodeSpacing||50,b=l.rankSpacing||50;a.l.info(o.db.getRootDocV2()),o.db.extract(o.db.getRootDocV2()),a.l.info(o.db.getRootDocV2());const g=o.db.getStates(),h=new i.k({multigraph:!0,compound:!0}).setGraph({rankdir:H(o.db.getRootDocV2()),nodesep:p,ranksep:b,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));let u;q(h,void 0,o.db.getRootDocV2(),g,o.db,!0),"sandbox"===c&&(u=(0,n.Ys)("#i"+t));const f="sandbox"===c?(0,n.Ys)(u.nodes()[0].contentDocument.body):(0,n.Ys)("body"),$=f.select(`[id="${t}"]`),w=f.select("#"+t+" g");await(0,r.r)(w,h,["barb"],y,t);const m=8;a.u.insertTitle($,"statediagramTitleText",l.titleTopMargin,o.db.getDiagramTitle());const x=$.node().getBBox(),T=x.width+2*m,k=x.height+2*m;$.attr("class",y);const S=$.node().getBBox();(0,a.i)($,k,T,l.useMaxWidth);const D=`${S.x-m} ${S.y-m} ${T} ${k}`;a.l.debug(`viewBox ${D}`),$.attr("viewBox",D);const A=document.querySelectorAll('[id="'+t+'"] .edgeLabel .label');for(const i of A){const e=i.getBBox(),t=document.createElementNS("http://www.w3.org/2000/svg",d);t.setAttribute("rx",0),t.setAttribute("ry",0),t.setAttribute("width",e.width),t.setAttribute("height",e.height),i.insertBefore(t,i.firstChild)}},K={setConf:_,getClasses:j,draw:J},Q={parser:o.p,db:o.d,renderer:K,styles:o.s,init:e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,o.d.clear()}}}}]);