"use strict";(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[3271],{73271:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("a-row",{attrs:{gutter:0}},[e("a-col",{staticClass:"h-screen",staticStyle:{"border-right":"1px solid #f2f2f2"},attrs:{md:5,sm:24}},[e("a-spin",{staticClass:"h-full",attrs:{spinning:t.theme.loading}},[e("ThemeSettingForm",{attrs:{theme:t.theme.data,wrapperCol:{span:24}},on:{saved:t.onSettingsSaved},scopedSlots:t._u([{key:"descriptions-item",fn:function(){return[e("a-descriptions-item",[e("a-button",{on:{click:function(e){return t.handleRouteToThemeSetting()}}},[t._v("返回")])],1)]},proxy:!0}])})],1)],1),e("a-col",{staticClass:"h-screen",attrs:{md:19,sm:24}},[e("iframe",{attrs:{id:"themeViewIframe",src:t.options.blog_url,frameborder:"0",height:"100%",scrolling:"auto",width:"100%"}})])],1)},i=[],r=(a(57658),a(94136)),n=a(73541),o=a(20629),l={name:"ThemeVisualSetting",components:{ThemeSettingForm:r.Z},data(){return{theme:{data:{},loading:!1}}},computed:{...(0,o.Se)(["options"])},beforeRouteEnter(t,e,a){const s=t.query.themeId;a((async t=>{await t.handleGetTheme(s)}))},methods:{async handleGetTheme(t){try{this.theme.loading=!0;const{data:e}=await n.Z.theme.get(t);this.theme.data=e}finally{this.theme.loading=!1}},handleRouteToThemeSetting(){this.$router.push({name:"ThemeSetting",query:{themeId:this.theme.id}})},onSettingsSaved(){document.getElementById("themeViewIframe").contentWindow.location.reload()}}},h=l,m=a(1001),d=(0,m.Z)(h,s,i,!1,null,"19de66d0",null),c=d.exports},94136:function(t,e,a){a.d(e,{Z:function(){return m}});var s=function(){var t=this,e=t._self._c;return t.theme.id?e("div",{staticClass:"card-container h-full"},[e("a-tabs",{staticClass:"h-full",attrs:{defaultActiveKey:"0",type:"card"}},[e("a-tab-pane",{key:0,attrs:{tab:"关于"}},[t.theme.logo?e("div",[e("a-avatar",{attrs:{alt:t.theme.name,size:72,src:t.theme.logo,shape:"square"}}),e("a-divider")],1):t._e(),e("a-descriptions",{attrs:{column:1,layout:"horizontal"}},[e("a-descriptions-item",{attrs:{label:"作者"}},[e("a",{staticClass:"text-inherit",attrs:{href:t.theme.author.website||"#",target:"_blank"}},[t._v(" "+t._s(t.theme.author.name)+" ")])]),e("a-descriptions-item",{attrs:{label:"介绍"}},[t._v(" "+t._s(t.theme.description||"-")+" ")]),e("a-descriptions-item",{attrs:{label:"官网"}},[e("a",{staticClass:"text-inherit",attrs:{href:t.theme.website||"#",target:"_blank"}},[t._v(" "+t._s(t.theme.website||"-")+" ")])]),e("a-descriptions-item",{attrs:{label:"Git 仓库"}},[e("a",{staticClass:"text-inherit",attrs:{href:t.theme.repo||"#",target:"_blank"}},[t._v(" "+t._s(t.theme.repo||"-")+" ")])]),e("a-descriptions-item",{attrs:{label:"主题标识"}},[t._v(" "+t._s(t.theme.id)+" ")]),e("a-descriptions-item",{attrs:{label:"当前版本"}},[t._v(" "+t._s(t.theme.version)+" ")]),e("a-descriptions-item",{attrs:{label:"存储位置"}},[t._v(" "+t._s(t.theme.themePath)+" ")]),t._t("descriptions-item")],2)],1),t._l(t.form.configurations,(function(a,s){return e("a-tab-pane",{key:s+1,attrs:{tab:a.label}},[e("a-form",{attrs:{wrapperCol:t.wrapperCol,layout:"vertical"}},[t._l(a.items,(function(a,s){return e("SettingFormItem",{key:s,attrs:{itemSetting:a},model:{value:t.form.settings,callback:function(e){t.$set(t.form,"settings",e)},expression:"form.settings"}})})),e("a-form-item",[e("ReactiveButton",{attrs:{errored:t.form.saveErrored,loading:t.form.saving,erroredText:"保存失败",loadedText:"保存成功",text:"保存",type:"primary"},on:{callback:t.handleSaveSettingsCallback,click:t.handleSaveSettings}})],1)],2)],1)}))],2)],1):t._e()},i=[],r=a(73541),n={name:"ThemeSettingForm",props:{theme:{type:Object,default:()=>{}},wrapperCol:{type:Object,default:()=>({xxl:{span:10},lg:{span:14},md:{span:18},sm:{span:24}})}},data(){return{form:{settings:[],configurations:[],loading:!1,saving:!1,saveErrored:!1}}},watch:{theme(t){t&&this.handleGetConfigurations()}},methods:{async handleGetConfigurations(){try{const{data:t}=await r.Z.theme.listConfigurations(this.theme.id);this.form.configurations=t,await this.handleGetSettings()}catch(t){this.$log.error(t)}},async handleGetSettings(){try{const{data:t}=await r.Z.theme.listSettings(this.theme.id);for(let e in t)t[e]instanceof Array&&(t[e]=JSON.stringify(t[e]));this.form.settings=t}catch(t){this.$log.error(t)}},async handleSaveSettings(t=!0){try{t&&(this.form.saving=!0),await r.Z.theme.saveSettings(this.theme.id,this.form.settings)}catch(e){throw this.$log.error(e),this.form.saveErrored=!0,new Error(e)}finally{setTimeout((()=>{this.form.saving=!1}),400)}},handleSaveSettingsCallback(){this.form.saveErrored?this.form.saveErrored=!1:(this.handleGetSettings(),this.$emit("saved"))}}},o=n,l=a(1001),h=(0,l.Z)(o,s,i,!1,null,null,null),m=h.exports}}]);